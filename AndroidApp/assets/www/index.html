<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- JS/CSS required libs -->
<link rel="stylesheet" href="css/jquery.mobile-1.2.0.min.css" />
<!-- <script type="text/javascript" src="js/cordova-2.0.0.js"></script> -->
<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="js/jquery.mobile-1.2.0.min.js"></script>

<style type="text/css">
.loader {
	display: none;
}

</style>

</head>
<body>

	<!-- header -->
	<div data-role="header" data-id="header1" data-position="fixed">
		<h1>ImóvelAqui</h1>
		<div data-role="navbar">
			<ul>
				<li><a data-transition="slidedown"
					class="ui-btn-active ui-state-persist" href="index.html">Posicao
						atual</a></li>
				<li><a data-transition="slidedown" href="locEspecifica.html">Localização
						Específica</a></li>
				<li><a data-transition="slidedown" href="preferenciais.html">Preferenciais</a></li>
			</ul>
		</div>
	</div>
	<!-- /header -->



	<!-- content -->
	<div id="content" data-role="content">
		<img src="images/ajax-loader.gif" class="loader" alt="loader" />
		<div id="mainAccordion" data-role="collapsible-set">

			<div id="frmSearch" data-role="collapsible" data-collapsed="false">
				<h3>Pesquisar</h3>
				<form action="#" method="post">
					<label for="distancia">Distancia em km:</label> <input type="range" name="distancia" id="distancia" value="5" min="1" max="10" />
					<button type="submit" id="pesquisar" data-theme="b" name="pesquisar" value="submit-value" onclick="loadRequest()">Pesquisar</button>
				</form>
			</div>

			<div data-role="popup" id="resultPopup">
			
			</div>

			<!-- <div data-role="collapsible">
				<h3>Filtrar</h3>
				<p>//TODO: Implementar esta funcionalidade.</p>
			</div>  -->
			
<!-- 			<div id="result" data-role="collapsible"> -->
<!-- 				<h3>Resultado</h3> -->
<!-- 				<ul id="listView" data-role="listview" data-inset="true" data-filter="true"> -->
<!-- 					<li></li> -->
<!-- 				</ul> -->
<!-- 			</div> -->

		</div>
	</div>
	<!-- /content -->
	<script type="text/javascript">
		var actualPosition;
		
		$(document).ready(function() {
			
			navigator.geolocation.getCurrentPosition(onSuccess, onError);
			
		});
		
		// onSuccess Geolocation
		function onSuccess(position) {
			actualPosition = position.coords;
		}
		
		function getPosition(){
			return actualPosition;			
		}

		// onError Callback receives a PositionError object
		function onError(error) {
			alert('code: ' + error.code + '\n' + 'message: ' + error.message
					+ '\n');
		}

		function loadRequest() {
			var pos = getPosition();
			$.ajax({
						url : 'http://imovelaqui.co.cc/ModuloWeb/boundary/ModuloWebBoundary.action.php',
						type : 'post',
						data : {
							pesquisa : 'posicaoAtual',
							latitude : pos.latitude,
							longitude : pos.longitude,
        			//latitude: "-22.237233",
        			//longitude: "-45.9544205",
							distancia : $('#distancia').val()
						},
						dataType : 'json',
						//This method called when ajax request is succeful.
						success : function(jsonResponse) {
							var popup = $('#resultPopup');
							var html = "";

// 							popup.empty();

							$.each(jsonResponse, function(i, objJsonResponse, popup) {

								html += "<p>";
								html += objJsonResponse.imovel_tipo;
								html += ": " + objJsonResponse.contrato_tipo;
								html += " - " + objJsonResponse.endereco;
								html += ", " + objJsonResponse.numero;
								html += "</p>";
								
								$(popup).append(html);
								html = "";
							});

						},
						//This method is called case request fail.
						error:function(xhr,err){
						    alert("readyState: "+xhr.readyState+"\nstatus: "+xhr.status);
						    alert("responseText: "+xhr.responseText);
						},
						//This method run before send ajax request.
						beforeSend : function() {
							$('.loader').css({
								display : "block"
							});
						},
						//This method run when complete ajax request.
						complete : function() {
							popup.popup(open);
							
							$('.loader').css({
								display : "none"
							});
							$('#listView').css({
								display: "block"
							});
						}

					});
		}
	
	</script>
</body>
</html>